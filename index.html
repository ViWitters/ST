<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>
<body>

    <div id="background"></div>

    <div class="container">
  <div class="box">
<div class="grid">

  <div class="cell left">
    üå°Ô∏è Temperatuur
  </div>

  <div class="cell v-divider"></div>

  <div class="cell right">
    üíß NTU
  </div>

  
  <div class="h-divider"></div>

  <div class="cell left value" id="tempValue">
     --¬∞C
  </div>

  <div class="cell v-divider"></div>

  <div class="cell right value" id="ntuValue"> 
    -- NTU
  </div>

</div>

<div class="h-divider"></div>

<div class="footer" id="lastUpdate">
  Laatste update: --
</div>
 
<canvas id="tempChart"></canvas>

</div>

</div>

<script>

  const ctx = document.getElementById('tempChart').getContext('2d');

  
  const tempChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: [], 
      datasets: [{
        label: 'Temperatuur (¬∞C)',
        data: [], 
        borderColor: 'rgba(255, 99, 132, 1)', 
        backgroundColor: 'rgba(255, 99, 132, 0.2)', 
        fill: false, 
        tension: 0.3 ,
        yAxisID: 'yLeft'
      },
      {
        label: 'NTU',
        data: [],
        borderColor: 'rgba(54, 162, 235, 1)',
        backgroundColor: 'rgba(54, 162, 235, 0.2)',
        fill: false,
        tension: 0.3,
        yAxisID: 'yRight'
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: {
          position: 'top',
        },
      },
      scales: {
        x: {
          title: {
            display: true,
            text: 'Tijd'
          },

          ticks: {
            maxRotation: 45,
            minRotation: 30,
            autoSkip: true,
            maxTicksLimit: 10
          }
        },
        yLeft: {
          type: 'linear',
          position: 'left',
          title: {
            display: true,
            text: 'Temperatuur (¬∞C)'
          },
          min : 0,
          max : 50
        },
        yRight: {
          type: 'linear',
          position: 'right',
          title: {
            display: true,
            text: 'NTU'
          },
          min : 0,
          max : 10,
          grid: {
            drawOnChartArea: false
            }
        }
      }
    }
  });
</script>



<script>
async function getLiveData() {
    const urlTemp = 'https://api.thingspeak.com/channels/3243838/fields/1/last.json';
    const urlNTU = 'https://api.thingspeak.com/channels/3243838/fields/2/last.json';
    
    try {
        const resTemp = await fetch(urlTemp);
        const dataTemp = await resTemp.json();
        const temp = parseFloat(dataTemp.field1);

        const resNTU = await fetch(urlNTU);
        const dataNTU = await resNTU.json();
        const ntu = parseFloat(dataNTU.field1);

        const now = new Date();
        const label = now.getHours() + ':' + (now.getMinutes()<10?'0':'') + now.getMinutes();

        addData(label, temp, ntu);

    } catch (error) {
        console.error('Fout bij ophalen data:', error);
    }
}

function addData(label, temp, ntu) {
    tempChart.data.labels.push(label);
    tempChart.data.datasets[0].data.push(temp); 
    tempChart.data.datasets[1].data.push(ntu); 

    

    tempChart.update();
}

setInterval(getLiveData, 15000);
getLiveData();
</script>

</body>
</html>